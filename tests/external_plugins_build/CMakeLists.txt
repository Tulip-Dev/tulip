INCLUDE_DIRECTORIES(${TulipCoreInclude} ${TulipCoreBuildInclude})

SET(TEST_EXTERNAL_PLUGINS_LOAD test_external_plugins_load)

ADD_EXECUTABLE(${TEST_EXTERNAL_PLUGINS_LOAD} ../plugins/pluginsloadingtest.cpp)
TARGET_LINK_LIBRARIES(${TEST_EXTERNAL_PLUGINS_LOAD} ${LibTulipCoreName})

SET_SOURCE_FILES_PROPERTIES(../plugins/pluginsloadingtest.cpp
                            PROPERTIES COMPILE_DEFINITIONS "TULIP_PLUGINS_DIR=\"\";TULIP_BUILD_CORE_ONLY=\"1\"")

STRING(REPLACE ";" "\;" LIBRARY_PATH "${CMAKE_LIBRARY_PATH}")
ADD_TEST(NAME "ExternalPluginsBuildTest"
         COMMAND ${CMAKE_COMMAND}
          -DTULIP_BIN_DIR=${CMAKE_BINARY_DIR}
          -DPLUGINS_SRC_DIR=${CMAKE_CURRENT_SOURCE_DIR}/plugins_src
          -DCMAKE_GENERATOR=${CMAKE_GENERATOR}
          -DCMAKE_BUILD_TYPE=${CMAKE_BUILD_TYPE}
          -DCMAKE_C_COMPILER=${CMAKE_C_COMPILER}
          -DCMAKE_CXX_COMPILER=${CMAKE_CXX_COMPILER}
          -DCMAKE_LIBRARY_PATH=${LIBRARY_PATH}
          -DCMAKE_INSTALL_PREFIX=${CMAKE_INSTALL_PREFIX}
          -DMSVC=${MSVC}
          -DMSVC_CONFIGURATION=$<CONFIGURATION>
          -DTEST_EXTERNAL_PLUGINS_LOAD=${TEST_EXTERNAL_PLUGINS_LOAD}
          -P ${CMAKE_CURRENT_SOURCE_DIR}/build_and_test_plugin.cmake
         WORKING_DIRECTORY ${CMAKE_CURRENT_BINARY_DIR})
